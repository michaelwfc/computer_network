For build prereqs, see [the CS144 VM setup instructions](https://web.stanford.edu/class/cs144/vm_howto).


## cmake: Sponge quickstart
To set up your build directory:
```bash
$ mkdir -p <path/to/sponge>/build
$ cd <path/to/sponge>/build
$ cmake ..
```
### What does `cmake ..` do?
The command `cmake ..` performs the following:
- **Configures the build system**: It reads the `CMakeLists.txt` file from the parent directory (..)
- **Generates build files**: Creates Makefiles or other build system files needed to compile the project
    - Makefiles
    - other build system files: Could be Ninja files, CMake files, MSBuild files, etc.
  
- **Sets up compilation parameters**: Determines compiler settings, dependencies, and build targets
- **Prepares for compilation**: Sets up the environment so you can later run `make` to actually compile the code
The .. indicates that the CMake configuration file (`CMakeLists.txt`) is located one directory level up from where you're running the command (in the build directory). This is part of the standard out-of-source build pattern where build artifacts are kept separate from source code.


### Explanation of the CMakeLists.txt file ?

The [CMakeLists.txt](file:///home/cs144/computer_network/sponge/CMakeLists.txt) file in the Sponge networking library defines the build configuration and structure for the entire project:

Basic Project Configuration
- **`cmake_minimum_required (VERSION 2.8.5)`** - Sets the minimum required CMake version
- **`cmake_policy (SET CMP0054 NEW)`** - Sets a specific CMake policy regarding string comparisons
- **`project (Sponge)`** - Defines the project name as "Sponge"

Include External Configuration Files
The project includes multiple external CMake files that provide additional functionality:
- **[etc/build_defs.cmake](file:///home/cs144/computer_network/sponge/etc/build_defs.cmake)** - Contains basic build definitions and macros
- **[etc/build_type.cmake](file:///home/cs144/computer_network/sponge/etc/build_type.cmake)** - Handles build type configurations (Debug, Release, etc.)
- **[etc/cflags.cmake](file:///home/cs144/computer_network/sponge/etc/cflags.cmake)** - Manages compiler flags
- **[etc/doxygen.cmake](file:///home/cs144/computer_network/sponge/etc/doxygen.cmake)** - Configures Doxygen documentation generation
- **[etc/clang_format.cmake](file:///home/cs144/computer_network/sponge/etc/clang_format.cmake)** - Sets up clang-format for code formatting
- **[etc/clang_tidy.cmake](file:///home/cs144/computer_network/sponge/etc/clang_tidy.cmake)** - Configures clang-tidy for static analysis
- **[etc/cppcheck.cmake](file:///home/cs144/computer_network/sponge/etc/cppcheck.cmake)** - Integrates cppcheck for static analysis
- **[etc/tests.cmake](file:///home/cs144/computer_network/sponge/etc/tests.cmake)** - Defines test-related build targets

Header Search Paths
The following lines add directories to the header search path:
- **`${PROJECT_SOURCE_DIR}/libsponge/util`** - Utility classes and functions
- **`${PROJECT_SOURCE_DIR}/libsponge/tcp_helpers`** - TCP helper implementations
- **`${PROJECT_SOURCE_DIR}/libsponge`** - Main library headers

Subdirectories
The project organizes its components into subdirectories:
- **[libsponge](file:///home/cs144/computer_network/sponge/libsponge/)** - Core networking library implementation
- **[apps](file:///home/cs144/computer_network/sponge/apps/)** - Applications built using the library
- **[tests](file:///home/cs144/computer_network/sponge/tests/)** - Unit tests and integration tests
- **[doctests](file:///home/cs144/computer_network/sponge/doctests/)** - Documentation tests

This structure allows for modular development and separates the library code from applications, tests, and documentation while maintaining proper dependencies between them.



### What are `Makefiles` or other build system files?
Based on the context from the Sponge networking library README, here's an explanation:

**Makefiles** and **other build system files** are configuration files that contain instructions for building software projects:

#### Makefiles
- **Text files** containing rules and dependencies that tell the `make` utility how to compile and link source code
- Define **targets**, **dependencies**, and **commands** needed to build executables from source code
- Specify which source files need to be compiled together and in what order
- Include information about compiler flags, libraries, and linking requirements

#### Other Build System Files
- Could be **Ninja files**, **CMake files**, **MSBuild files**, etc.
- In the context of the Sponge project, these would be generated by `cmake ..` from the [CMakeLists.txt](file:///home/cs144/computer_network/sponge/CMakeLists.txt) file
- Provide alternative ways to manage the build process beyond traditional Makefiles

#### Purpose
- **Automate compilation**: Save developers from manually typing compilation commands for each source file
- **Handle dependencies**: Track which files depend on others and rebuild only what's necessary
- **Optimize builds**: Only recompile files that have changed since the last build
- **Manage complexity**: Handle complex software projects with hundreds or thousands of source files

As mentioned in the README, the `cmake ..` command generates these files in the build directory based on the configuration found in the parent directory's [CMakeLists.txt](file:///home/cs144/computer_network/sponge/CMakeLists.txt) file.




**Note:** all further commands listed below should be run from the `build` dir.

## To build:

```bash
$ make

# You can use the `-j` switch to build in parallel, e.g.,
$ make -j$(nproc)

# To test (after building; make sure you've got the [build prereqs](https://web.stanford.edu/class/cs144/vm_howto) installed!)
$ make check_lab0
# or
$ make check_lab1
# etc.
```

The first time you run a `make check`, it may run `sudo` to configure two
[TUN](https://www.kernel.org/doc/Documentation/networking/tuntap.txt) devices for use during testing.

### build options

You can specify a different compiler when you run cmake:
```bash
$ CC=clang CXX=clang++ cmake ..
```
You can also specify `CLANG_TIDY=` or `CLANG_FORMAT=` (see "other useful targets", below).

Sponge's build system supports several different build targets. 
- By default, cmake chooses the `Release` target, which enables the usual optimizations. 
- The `Debug` target enables debugging and reduces the level of optimization. To choose the `Debug` target:

```bash
$ cmake .. -DCMAKE_BUILD_TYPE=Debug
```
The following targets are supported:

- `Release` - optimizations
- `Debug` - debug symbols and `-Og`
- `RelASan` - release build with [ASan](https://en.wikipedia.org/wiki/AddressSanitizer) and
  [UBSan](https://developers.redhat.com/blog/2014/10/16/gcc-undefined-behavior-sanitizer-ubsan/)
- `RelTSan` - release build with
  [ThreadSan](https://developer.mozilla.org/en-US/docs/Mozilla/Projects/Thread_Sanitizer)
- `DebugASan` - debug build with ASan and UBSan
- `DebugTSan` - debug build with ThreadSan

Of course, you can combine all of the above, e.g.,

    $ CLANG_TIDY=clang-tidy-6.0 CXX=clang++-6.0 .. -DCMAKE_BUILD_TYPE=Debug

**Note:** if you want to change `CC`, `CXX`, `CLANG_TIDY`, or `CLANG_FORMAT`, you need to remove
`build/CMakeCache.txt` and re-run cmake. (This isn't necessary for `CMAKE_BUILD_TYPE`.)

### other useful targets

To generate documentation (you'll need `doxygen`; output will be in `build/doc/`):

    $ make doc

## To lint 
(you'll need `clang-tidy`):

    $ make -j$(nproc) tidy

To run cppcheck (you'll need `cppcheck`):

    $ make cppcheck

To format (you'll need `clang-format`):

    $ make format

To see all available targets,

    $ make help


### What does "lint" mean?

Based on the context from the Sponge networking library README, **lint** refers to:

Definition
**Lint** is a tool that analyzes source code to identify potential bugs, style inconsistencies, and programming errors without actually executing the code. It's a form of **static analysis**.

Purpose
- **Find potential bugs** early in the development process
- **Enforce coding standards** and style guidelines
- **Detect suspicious constructs** that might lead to errors
- **Improve code quality** and maintainability

In the Sponge Project Context
The README shows:
```bash
$ make -j$(nproc) tidy
```

This command runs **clang-tidy** (a C++ linter) across the project, which:
- Analyzes C++ source files for common issues
- Checks for adherence to coding best practices
- Identifies potential logical errors
- Ensures consistent code style

### Other Linters
Different languages have their own linters:
- **JavaScript**: ESLint, JSLint
- **Python**: Pylint, flake8
- **Java**: Checkstyle, PMD
- **C/C++**: Clang-Tidy (used in Sponge), cppcheck

### Usage in Development Workflow
Linting is typically integrated into the build process (as shown in the README) to ensure code quality standards are maintained throughout development. Running `make tidy` in the Sponge project will analyze all source files and report any issues that need to be addressed.